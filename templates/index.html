<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞—Å—Ç–µ—Ä–æ–∫ ‚Äî —Å—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª—ã</title>
    <link rel="stylesheet" href="/static/style.css?v=30">
</head>

<body>

<header class="fade-up">
    –ú–∞—Å—Ç–µ—Ä–æ–∫
</header>

<div id="cartCount">üõí –ö–æ—Ä–∑–∏–Ω–∞ (0)</div>

<section class="fade-up">
    <h2>–ö–∞—Ç–∞–ª–æ–≥</h2>

    <div class="products">
        {% for p in products %}
        <div class="product fade-up">
            <h3>{{ p.name }}</h3>
            <p>–¶–µ–Ω–∞: {{ p.price }} ‚ÇΩ</p>
            <button
                data-name="{{ p.name }}"
                data-price="{{ p.price }}"
                onclick="addToCart(this)"
            >
                –ö—É–ø–∏—Ç—å
            </button>
        </div>
        {% endfor %}
    </div>
</section>

<section class="fade-up">
    <h2>–ó–∞—è–≤–∫–∞ –≤ –∫–æ–º–∞–Ω–¥—É</h2>
    <form method="post" action="/team">
        <input type="text" name="name" placeholder="–í–∞—à–µ –∏–º—è" required>
        <input type="text" name="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required>
        <select name="service">
            <option>–î–æ—Å—Ç–∞–≤–∫–∞</option>
            <option>–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</option>
            <option>–û–ø—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑</option>
        </select>
        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>
</section>

<button id="toTop">‚Üë</button>

<!-- ===== CART MODAL ===== -->
<div id="cartModal" class="cart-modal">
    <div class="cart-content fade-up">
        <h3>–ö–æ—Ä–∑–∏–Ω–∞</h3>
        <ul id="cartItems"></ul>
        <button onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <button onclick="closeCart()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>
/* ===== SCROLL TO TOP ===== */
const toTopBtn = document.getElementById("toTop");

window.addEventListener("scroll", () => {
    toTopBtn.style.display = window.scrollY > 300 ? "block" : "none";
});

toTopBtn.onclick = () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
};

/* ===== CART ===== */
let cart = JSON.parse(localStorage.getItem("cart")) || [];

function saveCart() {
    localStorage.setItem("cart", JSON.stringify(cart));
}

function updateCart() {
    const totalQty = cart.reduce((sum, item) => sum + item.qty, 0);
    document.getElementById("cartCount").innerText =
        "üõí –ö–æ—Ä–∑–∏–Ω–∞ (" + totalQty + ")";
}

function addToCart(btn) {
    const name = btn.dataset.name;
    const price = Number(btn.dataset.price);

    const item = cart.find(i => i.name === name);

    if (item) {
        item.qty++;
    } else {
        cart.push({ name, price, qty: 1 });
    }

    saveCart();
    updateCart();
}

function openCart() {
    document.getElementById("cartModal").style.display = "block";
    renderCart();
}

function renderCart() {
    const list = document.getElementById("cartItems");
    list.innerHTML = "";

    let total = 0;

    cart.forEach((item, index) => {
        total += item.price * item.qty;

        const li = document.createElement("li");
        li.innerHTML = `
            <span>${item.name} ‚Äî ${item.price} ‚ÇΩ √ó ${item.qty}</span>
            <div style="display:flex; gap:6px;">
                <button onclick="changeQty(${index}, -1)">‚àí</button>
                <button onclick="changeQty(${index}, 1)">+</button>
                <button onclick="removeItem(${index})">‚ùå</button>
            </div>
        `;
        list.appendChild(li);
    });

    const totalLi = document.createElement("li");
    totalLi.style.fontWeight = "bold";
    totalLi.style.marginTop = "10px";
    totalLi.innerText = "–ò—Ç–æ–≥–æ: " + total + " ‚ÇΩ";
    list.appendChild(totalLi);
}

function changeQty(index, delta) {
    cart[index].qty += delta;

    if (cart[index].qty <= 0) {
        cart.splice(index, 1);
    }

    saveCart();
    updateCart();
    renderCart();
}

function removeItem(index) {
    cart.splice(index, 1);
    saveCart();
    updateCart();
    renderCart();
}

function clearCart() {
    cart = [];
    saveCart();
    updateCart();
    document.getElementById("cartItems").innerHTML = "";
}

function closeCart() {
    document.getElementById("cartModal").style.display = "none";
}

document.getElementById("cartCount").onclick = openCart;
updateCart();
</script>

</body>
</html>
