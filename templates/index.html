<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª—ã</title>
    <link rel="stylesheet" href="/static/style.css?v=3">
</head>

<body>

<header>
    –ú–∞—Å—Ç–µ—Ä–æ–∫
    <span id="cartCount" style="float:right; font-size:16px; cursor:pointer;">
        üõí –ö–æ—Ä–∑–∏–Ω–∞ (0)
    </span>
</header>

<section>

    <h2>–ö–∞—Ç–∞–ª–æ–≥</h2>

    <div class="products">
    {% for p in products %}
    <div class="product">
        <h3>{{ p.name }}</h3>
        <p>–¶–µ–Ω–∞: {{ p.price }} ‚ÇΩ</p>
        <button onclick="addToCart('{{ p.name }}', {{ p.price }})">
            –ö—É–ø–∏—Ç—å
        </button>
    </div>
    {% endfor %}
</div>

</section>

<section>
    <h2>–ó–∞—è–≤–∫–∞ –≤ –∫–æ–º–∞–Ω–¥—É</h2>
    <form method="post" action="/team">
        <input type="text" name="name" placeholder="–í–∞—à–µ –∏–º—è" required>
        <input type="text" name="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required>
        <select name="service">
            <option>–î–æ—Å—Ç–∞–≤–∫–∞</option>
            <option>–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</option>
            <option>–û–ø—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑</option>
        </select>
        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>
</section>

<button id="toTop">‚Üë</button>

<script>
const btn = document.getElementById("toTop");

window.addEventListener("scroll", () => {
    btn.style.display = window.scrollY > 300 ? "block" : "none";
});

btn.onclick = () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
};
</script>

<div id="cartModal" class="cart-modal">
    <div class="cart-content">
        <h3>–ö–æ—Ä–∑–∏–Ω–∞</h3>

        <ul id="cartItems"></ul>

        <button onclick="openOrder()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
        <button onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <button onclick="closeCart()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>
let cart = JSON.parse(localStorage.getItem("cart")) || [];

function saveCart() {
    localStorage.setItem("cart", JSON.stringify(cart));
}

function addToCart(name, price) {
    cart.push({ name, price });
    saveCart();
    updateCart();
}

function updateCart() {
    document.getElementById("cartCount").innerText =
        "üõí –ö–æ—Ä–∑–∏–Ω–∞ (" + cart.length + ")";
}

function openCart() {
    document.getElementById("cartModal").style.display = "block";
    const list = document.getElementById("cartItems");
    list.innerHTML = "";

    let total = 0;

    cart.forEach((item, index) => {
        const li = document.createElement("li");
        li.style.display = "flex";
        li.style.justifyContent = "space-between";
        li.style.alignItems = "center";

        li.innerHTML = `
    <span>${item.name} ‚Äî ${item.price} ‚ÇΩ</span>
    <button type="button" onclick="removeItem(${index})">‚ùå</button>
`;

        list.appendChild(li);
        total += item.price;
    });

    const totalLi = document.createElement("li");
    totalLi.style.fontWeight = "bold";
    totalLi.style.marginTop = "10px";
    totalLi.innerText = "–ò—Ç–æ–≥–æ: " + total + " ‚ÇΩ";
    list.appendChild(totalLi);
}


function closeCart() {
    document.getElementById("cartModal").style.display = "none";
}

function clearCart() {
    cart = [];
    saveCart();
    updateCart();
    document.getElementById("cartItems").innerHTML = "";
}

/* –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ */
function openOrder() {
    document.getElementById("cartModal").style.display = "none";
    document.getElementById("orderModal").style.display = "block";
}

function closeOrder() {
    document.getElementById("orderModal").style.display = "none";
}

function submitOrder() {
    const name = document.getElementById("orderName").value;
    const phone = document.getElementById("orderPhone").value;

    if (!name || !phone) {
        alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω");
        return;
    }

    let total = cart.reduce((sum, item) => sum + item.price, 0);

    alert(
        "–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑!\n\n" +
        "–ò–º—è: " + name + "\n" +
        "–¢–µ–ª–µ—Ñ–æ–Ω: " + phone + "\n" +
        "–°—É–º–º–∞: " + total + " ‚ÇΩ"
    );

    cart = [];
    saveCart();
    updateCart();
    closeOrder();
}

/* –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ */
updateCart();
document.getElementById("cartCount").onclick = openCart;

function removeItem(index) {
    cart.splice(index, 1);
    saveCart();
    updateCart();
    openCart(); // –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –∫–æ—Ä–∑–∏–Ω—É
}

</script>


<div id="orderModal" class="cart-modal">
    <div class="cart-content">
        <h3>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h3>

        <input type="text" id="orderName" placeholder="–í–∞—à–µ –∏–º—è">
        <input type="text" id="orderPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">

        <button onclick="submitOrder()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
        <button onclick="closeOrder()">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

</body>
</html>
